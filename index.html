<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cherry Blossom Tree - Clicker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="game-container clicker-only">
        <h1>ðŸŒ¸ Cherry Blossom Tree ðŸŒ¸</h1>
        <p class="nav-link"><a href="stats.html">Scoreboard & Upgrades â†’</a></p>

        <!-- Click Area -->
        <div class="panel click-area">
            <h2>Click the tree to add blossoms</h2>
            <p class="blossom-count">Blossoms on tree: <span id="crystalCount">0</span></p>
            <div class="tree-stage" id="treeStage">
                <img class="tree-bare" id="treeBare" src="images/empty-tree.png" alt="">
                <div class="tree-blossoms" id="treeBlossoms"></div>
                <button class="tree-hit-area" id="clickBtn" aria-label="Click tree to add cherry blossoms"></button>
            </div>
            <p class="click-text">Each click adds <span class="click-value" id="clickValueDisplay">+1</span> blossom<span id="pluralS">s</span></p>
            <div class="auto-indicator" id="autoIndicator">
                <p>Blossoms drifting in: <span class="auto-value" id="autoValue">0</span>/sec</p>
            </div>
        </div>
    </div>

    <script>
        const gameState = {
            crystals: 0,
            totalCrystals: 0,
            clickValue: 1,
            totalClicks: 0,
            autoClickValue: 0,
            upgrades: {},
            achievements: new Set()
        };

        const clickBtn = document.getElementById('clickBtn');
        const crystalCountEl = document.getElementById('crystalCount');
        const clickValueDisplayEl = document.getElementById('clickValueDisplay');
        const autoIndicatorEl = document.getElementById('autoIndicator');
        const autoValueEl = document.getElementById('autoValue');
        const pluralEl = document.getElementById('pluralS');
        const treeBlossomsEl = document.getElementById('treeBlossoms');

        // Blossom positions (canopy area) â€“ percentage from top-left of tree stage
        const BLOSSOM_MAX = 80;
        const BLOSSOM_IMG = 'images/cherry-blossom.png';
        const blossomPositions = (function () {
            const positions = [];
            for (let i = 0; i < BLOSSOM_MAX; i++) {
                const t = i / BLOSSOM_MAX;
                const angle = t * Math.PI * 0.85 + Math.PI * 0.08;
                const r = 32 + (i % 4) * 6 + (i % 7) * 3;
                positions.push({
                    x: 50 + Math.cos(angle) * r,
                    y: 28 + Math.sin(angle) * r * 0.75
                });
            }
            return positions;
        })();

        function renderBlossoms() {
            const n = Math.min(Math.floor(gameState.crystals), BLOSSOM_MAX);
            treeBlossomsEl.innerHTML = '';
            for (let i = 0; i < n; i++) {
                const p = blossomPositions[i];
                const img = document.createElement('img');
                img.src = BLOSSOM_IMG;
                img.alt = '';
                img.className = 'blossom-petal';
                img.style.left = p.x + '%';
                img.style.top = p.y + '%';
                treeBlossomsEl.appendChild(img);
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.floor(num).toString();
        }

        function createFloatingNumber(x, y, value) {
            const el = document.createElement('div');
            el.className = 'float-number';
            el.textContent = '+' + formatNumber(value) + ' ðŸŒ¸';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function updateUI() {
            crystalCountEl.textContent = formatNumber(gameState.crystals);
            clickValueDisplayEl.textContent = '+' + formatNumber(gameState.clickValue);
            if (pluralEl) pluralEl.textContent = gameState.clickValue === 1 ? '' : 's';
            renderBlossoms();
            if (gameState.autoClickValue > 0) {
                autoIndicatorEl.classList.add('active');
                autoValueEl.textContent = formatNumber(gameState.autoClickValue);
            }
        }

        clickBtn.addEventListener('click', (e) => {
            gameState.crystals += gameState.clickValue;
            gameState.totalCrystals += gameState.clickValue;
            gameState.totalClicks++;
            createFloatingNumber(e.clientX, e.clientY, gameState.clickValue);
            updateUI();
        });

        setInterval(() => {
            if (gameState.autoClickValue > 0) {
                gameState.crystals += gameState.autoClickValue;
                gameState.totalCrystals += gameState.autoClickValue;
                updateUI();
            }
        }, 1000);

        function saveGame() {
            const saveData = {
                crystals: gameState.crystals,
                totalCrystals: gameState.totalCrystals,
                clickValue: gameState.clickValue,
                totalClicks: gameState.totalClicks,
                autoClickValue: gameState.autoClickValue,
                upgrades: gameState.upgrades,
                achievements: Array.from(gameState.achievements)
            };
            localStorage.setItem('crystalClickerSave', JSON.stringify(saveData));
        }

        function loadGame() {
            const saved = localStorage.getItem('crystalClickerSave');
            if (saved) {
                const data = JSON.parse(saved);
                gameState.crystals = data.crystals || 0;
                gameState.totalCrystals = data.totalCrystals || 0;
                gameState.clickValue = data.clickValue || 1;
                gameState.totalClicks = data.totalClicks || 0;
                gameState.autoClickValue = data.autoClickValue || 0;
                gameState.upgrades = data.upgrades || {};
                gameState.achievements = new Set(data.achievements || []);
            }
        }

        loadGame();
        renderBlossoms();
        updateUI();

        setInterval(saveGame, 30000);
        window.addEventListener('beforeunload', saveGame);
    </script>
</body>
</html>
